package ourClasses;

import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Iterator;

import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.filechooser.FileNameExtensionFilter;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

/*
 * SiteJson handles importing and exporting of data to file.
 */
public class SiteJson {

	public static void exportFile() throws IOException {
		// The name of the file that is produced
		try (FileWriter file = new FileWriter("Site Collection Results.json")) {
			// this needs to be our array list
			file.write(AllSites.activeSites.toString());
			file.flush();
			// Message that appears once the data is saved to directory
			JOptionPane.showMessageDialog(null, "Please check your project directory folder for results", "Json Export",
					JOptionPane.INFORMATION_MESSAGE);

		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	public static void importFile() throws FileNotFoundException, IOException, ParseException {

		JFileChooser jfc = new JFileChooser();
		// filter to only select .xml or .json files
		FileNameExtensionFilter filter = new FileNameExtensionFilter(".json and .xml", "xml", "json");
		jfc.setFileFilter(filter);

		int returnValue = jfc.showOpenDialog(null);

		if (returnValue == JFileChooser.APPROVE_OPTION) {
			java.io.File inputFile = jfc.getSelectedFile();
			JSONParser parser = new JSONParser();

			Object obj = parser.parse(new FileReader(inputFile));

			JSONObject jsonObject = (JSONObject) obj;

			JSONArray site_reading = (JSONArray) jsonObject.get("site_readings");
			Iterator<?> i = site_reading.iterator();
			//print file to console
			while (i.hasNext()) {
				System.out.println(i.next());
			}
		} else {
			// Error message if the user closes JFileChooser without selecting anything
			JOptionPane.showMessageDialog(null, "No File Selected", "ERROR", JOptionPane.INFORMATION_MESSAGE);
		}
	}
}
